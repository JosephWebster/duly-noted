{"name":"./ts/classes/referenceCollection.ts","lines":[{"number":0,"longComment":true,"comment":""},{"number":1,"longComment":true,"comment":" # !ReferenceCollection"},{"number":2,"longComment":true,"comment":" @authors/chris"},{"number":3,"longComment":true,"comment":" @license"},{"number":4,"longComment":true,"comment":" "},{"number":5,"longComment":true,"comment":" This reference parser that parses all the links and anchors in your code - the output of which is two reference collections:"},{"number":6,"longComment":true,"comment":" * `internalReferences.json`"},{"number":7,"longComment":true,"comment":" * `externalReferences.json`"},{"number":8,"comment":""},{"number":9,"code":"import {findWhere, findIndex} from \"underscore\";"},{"number":10,"code":"import log4js = require(\"log4js\");"},{"number":11,"code":"let logger = log4js.getLogger(\"duly-noted::ReferenceCollection\");"},{"number":12,"code":""},{"number":13,"longComment":true,"comment":""},{"number":14,"longComment":true,"comment":" ## !interfaces/IReferenceCollection"},{"number":15,"comment":""},{"number":16,"code":"export interface IReferenceCollection {"},{"number":17,"code":"    id: string;"},{"number":18,"code":"    anchors?: IAnchor[];"},{"number":19,"code":"    subcollections?: IReferenceCollection[];"},{"number":20,"code":"}"},{"number":21,"code":""},{"number":22,"longComment":true,"comment":""},{"number":23,"longComment":true,"comment":" ## !interfaces/IAnchor"},{"number":24,"comment":""},{"number":25,"code":"export interface IAnchor {"},{"number":26,"code":"    id: string;"},{"number":27,"code":"    file: string;"},{"number":28,"code":"    line: number;"},{"number":29,"code":"}"},{"number":30,"code":""},{"number":31,"longComment":true,"comment":""},{"number":32,"longComment":true,"comment":" ## !interfaces/ITag"},{"number":33,"comment":""},{"number":34,"code":"export interface ITag {"},{"number":35,"code":"    anchor: string;"},{"number":36,"code":"    path: string;"},{"number":37,"code":"    linkStub: string;"},{"number":38,"code":"}"},{"number":39,"code":""},{"number":40,"longComment":true,"comment":""},{"number":41,"longComment":true,"comment":" ## !classes/ReferenceCollection"},{"number":42,"comment":""},{"number":43,"code":"export class ReferenceCollection implements IReferenceCollection {"},{"number":44,"code":"    id: string;"},{"number":45,"code":"    anchors: IAnchor[];"},{"number":46,"code":"    subcollections: IReferenceCollection[];"},{"number":47,"code":""},{"number":48,"longComment":true,"comment":""},{"number":49,"longComment":true,"comment":" ### Creates an instance of ReferenceCollection."},{"number":50,"comment":""},{"number":51,"code":"    constructor(id: string) {"},{"number":52,"code":"        this.id = id;"},{"number":53,"code":"        this.anchors = [];"},{"number":54,"code":"        this.subcollections = [];"},{"number":55,"code":"    }"},{"number":56,"code":""},{"number":57,"longComment":true,"comment":""},{"number":58,"longComment":true,"comment":" ## Recursively inflate a reference collection in the form of @interfaces/IReferenceCollection from flat data (likely from JSON file)"},{"number":59,"comment":""},{"number":60,"code":"    public inflate(collection: IReferenceCollection) {"},{"number":61,"code":"        this.id = collection.id;"},{"number":62,"code":"        this.anchors = collection.anchors;"},{"number":63,"code":"        for (let i = 0; i < collection.subcollections.length; i++) {"},{"number":64,"code":"            this.subcollections.push(new ReferenceCollection(collection.subcollections[i].id).inflate(collection.subcollections[i]));"},{"number":65,"code":"        }"},{"number":66,"code":"        return this;"},{"number":67,"code":"    }"},{"number":68,"code":""},{"number":69,"longComment":true,"comment":""},{"number":70,"longComment":true,"comment":" ## Add an !interface/IAnchor to collection"},{"number":71,"comment":""},{"number":72,"code":"    public addAnchor(anchor: IAnchor): void {"},{"number":73,"code":"        let existing = findWhere(this.anchors, {id: anchor.id});"},{"number":74,"code":"        if (existing) {"},{"number":75,"code":"            logger.error(\"Cannot add anchor '\" + anchor.id + \"' from \" + anchor.file + \":\" + anchor.line + \" to '\" + this.id + \"' collection because it was already defined at \" + existing.file + \":\" + existing.line);"},{"number":76,"code":"        }"},{"number":77,"code":""},{"number":78,"code":"        this.anchors.push(anchor);"},{"number":79,"code":"    }"},{"number":80,"code":""},{"number":81,"longComment":true,"comment":""},{"number":82,"longComment":true,"comment":" ## Add a subcollection to this collection in the form of an @interfaces/IReferenceCollection"},{"number":83,"comment":""},{"number":84,"code":"    public addSubcollection(collection: IReferenceCollection): void {"},{"number":85,"code":"        let existingAnchor = findWhere(this.anchors, {id: collection.id});"},{"number":86,"code":"        if (existingAnchor) {"},{"number":87,"code":"            logger.error(\"Cannot add collection '\" + collection.id + \"' because it was already defined as an anchor \" + existingAnchor.file + \":\" + existingAnchor.line);"},{"number":88,"code":"            return;"},{"number":89,"code":"        }"},{"number":90,"code":""},{"number":91,"code":"        let existingCollection = findWhere(this.anchors, {id: collection.id});"},{"number":92,"code":"        if (existingCollection) {"},{"number":93,"code":"            logger.error(\"Cannot add collection '\" + collection.id + \"' because it was already defined as a subcollection of '\" + collection.id +  \"'\");"},{"number":94,"code":"            return;"},{"number":95,"code":"        }"},{"number":96,"code":""},{"number":97,"code":"        this.subcollections.push(collection);"},{"number":98,"code":"    }"},{"number":99,"code":""},{"number":100,"longComment":true,"comment":""},{"number":101,"longComment":true,"comment":" ## Add Anchor Tag to the appropriate subcollection"},{"number":102,"longComment":true,"comment":" Recursively skims the collection and subcollections to place anchor in the correct place."},{"number":103,"comment":""},{"number":104,"code":"    public addAnchorTag(anchorTag: string[], fileName: string, lineNumber: number): void {"},{"number":105,"code":"        logger.debug(\"processing new anchorTag: \" + JSON.stringify(anchorTag));"},{"number":106,"code":"        if (anchorTag.length === 1) {"},{"number":107,"code":"            logger.debug(\"Adding anchor tag:\" + anchorTag[0]);"},{"number":108,"code":"            this.addAnchor({"},{"number":109,"code":"                id: anchorTag[0],"},{"number":110,"code":"                line: lineNumber,"},{"number":111,"code":"                file: fileName"},{"number":112,"code":"            });"},{"number":113,"code":"            return;"},{"number":114,"code":"        } else {"},{"number":115,"code":"            let collectionTag = anchorTag.shift();"},{"number":116,"code":""},{"number":117,"code":"            let i = findIndex(this.subcollections, (item) => {"},{"number":118,"code":"                return item.id === collectionTag;"},{"number":119,"code":"            });"},{"number":120,"code":""},{"number":121,"code":"            if (i > -1) {"},{"number":122,"code":"            logger.debug(\"Collection present:\" + collectionTag);"},{"number":123,"code":""},{"number":124,"code":"            return this.subcollections[i].addAnchorTag(anchorTag, fileName, lineNumber);"},{"number":125,"code":"            } else {"},{"number":126,"code":"                logger.debug(\"Collection not present:\" + collectionTag);"},{"number":127,"code":"                let newSubCollection = new ReferenceCollection(collectionTag);"},{"number":128,"code":"                newSubCollection.addAnchorTag(anchorTag, fileName, lineNumber);"},{"number":129,"code":"                this.addSubcollection(newSubCollection);"},{"number":130,"code":"                return;"},{"number":131,"code":"            }"},{"number":132,"code":"        }"},{"number":133,"code":"    }"},{"number":134,"code":""},{"number":135,"longComment":true,"comment":""},{"number":136,"longComment":true,"comment":" ## Get All the tags in a collection and its subcollections"},{"number":137,"longComment":true,"comment":" Recursively cull all of the tags."},{"number":138,"comment":""},{"number":139,"code":"    public getAllTags(parentPath?: string, depth?: number): ITag[] {"},{"number":140,"code":"        parentPath = parentPath || \"\";"},{"number":141,"code":"        depth = depth || 0;"},{"number":142,"code":""},{"number":143,"code":"        let allTags: ITag[] = [];"},{"number":144,"code":"        if (depth > 0) {"},{"number":145,"code":""},{"number":146,"code":"            for (let i = 0; i < this.anchors.length; i++) {"},{"number":147,"code":"                if (parentPath !== \"\" && parentPath !== null) {"},{"number":148,"code":"                    allTags.push({"},{"number":149,"code":"                        anchor: parentPath + \"/\" + this.id + \"/\" + this.anchors[i].id,"},{"number":150,"code":"                        path: this.anchors[i].file,"},{"number":151,"code":"                        linkStub: this.anchors[i].id"},{"number":152,"code":"                    });"},{"number":153,"code":"                } else {"},{"number":154,"code":"                    allTags.push({"},{"number":155,"code":"                        anchor: this.id + \"/\" + this.anchors[i].id,"},{"number":156,"code":"                        path: this.anchors[i].file,"},{"number":157,"code":"                        linkStub: this.anchors[i].id"},{"number":158,"code":"                    });"},{"number":159,"code":"                }"},{"number":160,"code":"            }"},{"number":161,"code":""},{"number":162,"code":"            for (let i = 0; i < this.subcollections.length; i++) {"},{"number":163,"code":"                allTags = allTags.concat(this.subcollections[i].getAllTags(parentPath + \"/\" + this.id,  depth + 1));"},{"number":164,"code":"            }"},{"number":165,"code":"        } else {"},{"number":166,"code":""},{"number":167,"code":"            for (let i = 0; i < this.anchors.length; i++) {"},{"number":168,"code":"                allTags.push({"},{"number":169,"code":"                    anchor: this.anchors[i].id,"},{"number":170,"code":"                    path: this.anchors[i].file,"},{"number":171,"code":"                    linkStub: this.anchors[i].id"},{"number":172,"code":"                });"},{"number":173,"code":"            }"},{"number":174,"code":""},{"number":175,"code":"            for (let i = 0; i < this.subcollections.length; i++) {"},{"number":176,"code":"                allTags = allTags.concat(this.subcollections[i].getAllTags(null, depth + 1));"},{"number":177,"code":"            }"},{"number":178,"code":"        }"},{"number":179,"code":""},{"number":180,"code":"        return allTags;"},{"number":181,"code":"    }"},{"number":182,"code":""},{"number":183,"longComment":true,"comment":""},{"number":184,"longComment":true,"comment":" ## Get a list of anchors sorted by an array of all the collections."},{"number":185,"comment":""},{"number":186,"code":"    public getTagsByCollection (allCollections?, parentPath?) {"},{"number":187,"code":"        allCollections = allCollections || [];"},{"number":188,"code":"        parentPath = parentPath || \"\";"},{"number":189,"code":"        let id = parentPath + \"/\" + this.id;"},{"number":190,"code":""},{"number":191,"code":"        allCollections.push({"},{"number":192,"code":"            name: id,"},{"number":193,"code":"            anchors: []"},{"number":194,"code":"        });"},{"number":195,"code":""},{"number":196,"code":"        for (let i = 0; i < this.anchors.length; i++) {"},{"number":197,"code":"            allCollections[allCollections.length - 1].anchors.push({"},{"number":198,"code":"                anchor: this.anchors[i].id,"},{"number":199,"code":"                path: this.anchors[i].file,"},{"number":200,"code":"                linkStub: this.anchors[i].id"},{"number":201,"code":"            });"},{"number":202,"code":"        }"},{"number":203,"code":""},{"number":204,"code":"        for (let i = 0; i < this.subcollections.length; i++) {"},{"number":205,"code":"            allCollections = this.subcollections[i].getTagsByCollection(allCollections, id);"},{"number":206,"code":"        }"},{"number":207,"code":""},{"number":208,"code":"        return allCollections;"},{"number":209,"code":"    }"},{"number":210,"code":"}"}],"type":"typescript"}